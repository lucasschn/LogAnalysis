\documentclass{article}

\usepackage{fancyref}
\usepackage{float}
\usepackage{graphicx}

\title{H520 Battery State of Charge Estimator}


\begin{document} 

\section{State of charge and problem description}

The aim of the project is to estimate precisely the state of charge $z(t)$ of a battery. Estimation is required because the state of charge is defined as \

\begin{equation}
\frac{avg concentration of charges}{maximum concentration of charges}
\end{equation}

which is not possible to measure directly, as we are not opening the battery. The only available measurements to us are the current and the voltage measurement. In a battery electrical model, the \textit{current} $i(t)$ is considered as the input and the \textit{load} or \textit{terminal voltage} $v(t)$ is the output. Due to control system notations, this signals will sometimes be denoted $u(t)$ for the input and $y(t)$ for the output in the following.
The state of charge is then equal to 1 when the battery holds as many charges as it can. This quantity of charges is denoted $Q$, and to when it is fully discharged. Sometimes, the concepts of fully charged and fully discharged can be a bit vague. That is why the full and empty state of charge are defined by the battery manufacturer. In the case of the H520, the battery states are defined as follows :

\begin{table}[h]
\centering
\begin{tabular}{c|c|c}
    State of charge & z & Open Circuit Voltage \\
    \hline
    Fully charged & 1 & 4.35 V \\
    \hline
    Fully discharged & 0 & 3.4 V \\

\end{tabular}
\caption{SOC extrema definition with respect to OCV}
\label{maxSOCOCV}
\end{table}

where the open circuit voltage is the value of the terminal voltage (measured by the voltage sensor) when the battery is at equlibrium, meaning that it has been rested for long enough. The state of charge evolves between 1 and 0 in direct correlation to the current that has been drawn from thre battery. The current acts as pumping charges out or in the reservoir of charge, the battery. 

\begin{equation}
    \dot{z}(t) = -\frac{i(t)}{Q} \Leftrightarrow z(t) = z(t_0) - \frac{1}{Q} \int_{t_0}^t i(\tau) dt
\label{SOCfromi}
\end{equation}

One could say that \ref{SOCfromi} is enough to estimate the state of charge of a battery. However, due to the integral, any biais in the current measurement would lead to an accumulation of error. Also, the voltage meaurement has not been used and this information is then lost, instead of enhancing the precision of the estimation.
Unfortunately, the relationship between the state of charge and the terminal voltage to be measured is not starightforward and involves some king of modelisation of the battery. Indeed, the terminal voltage is a dydnamic quantity that is strongly influenced not only by how much current is drawn from the battery at this moment battery, but also on the current history. This is why a dynamic system model is needed. 


\section{Equivalent circuit model}

A battery is an electro-chemical system. It undergoes simultaneously electrical and chemical processes, such as ions diffusion, resistance-due voltage drops, etc. 

However, in order to describe it with difference equations, it is useful to make an analogy with as a purely electrical system, having the same properties. This electrical system can be linear or nonlinear depending if hysteresis has to be taken into account or not. Also, the linear part is constituted, like in any other linear system, of a certain number of poles and this number has to be decided. It will then lead to a certain number of linear element in the circuit, in particular resistances and capacitors. 
A basic system that contains enough dynamics to have a good overview of the role of each element is the Thevenin model. Its characteristics are : 

\begin{enumerate}
\item Linear elements only 
\item One pole pair of resistance-capacitor, plus one pole due to the integral effect of the state of charge on the input (the current), leading to a two poles system. 

\end{enumerate}


The Thevenin Equivalent Circuit (EC) model presents as shown on Figure \ref{fig:Thevenin_model}.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{Thevenin_model.png}
    \caption{Thevenin Equivalent Circuit Model}
    \label{fig:Thevenin_model}
\end{figure}

\end{document}